#+TITLE: ox-pandoc

=ox-pandoc= is an 
[[https://orgmode.org/manual/Exporting.html#Exporting][exporter]] for
[[https://orgmode.org/][Org mode]] which converts Org-mode files to a
wide variety of other formats using the [[https://pandoc.org/][pandoc]]
tool. Pandoc can produce PDFs, HTML, presentations, markdown files,
office documents and e-pub publications as well as a number of other
more specialised formats.

* Supported Formats

You can convert an Org-mode file to various formats with simple
commands. The following table shows the supported formats:

| format            | extension | buffer | file |
|-------------------+-----------+--------+------|
| asciidoc          | txt       | yes    | yes  |
| beamer            | tex       | yes    | yes  |
| beamer-pdf        | pdf       | no     | yes  |
| commonmark        | md        | yes    | yes  |
| context           | tex       | yes    | yes  |
| docbook           | xml       | yes    | yes  |
| docx              |           | no     | yes  |
| dzslides          | html      | yes    | yes  |
| epub2             | epub      | no     | yes  |
| epub3             | epub      | no     | yes  |
| fb2               | fb2       | yes    | yes  |
| gfm               | md        | yes    | yes  |
| html4             | html      | yes    | yes  |
| html5             | html      | yes    | yes  |
| icml              |           | yes    | yes  |
| json              |           | yes    | yes  |
| latex             | tex       | yes    | yes  |
| latex-pdf         | pdf       | no     | yes  |
| man               |           | yes    | yes  |
| markdown          | md        | yes    | yes  |
| markdown_github   | md        | yes    | yes  |
| markdown_mmd      | md        | yes    | yes  |
| markdown_phpextra | md        | yes    | yes  |
| markdown_strict   | md        | yes    | yes  |
| mediawiki         |           | yes    | yes  |
| native            | hs        | yes    | yes  |
| odt               |           | no     | yes  |
| opendocument      | xml       | yes    | yes  |
| opml              |           | yes    | yes  |
| org               |           | yes    | yes  |
| plain             | txt       | yes    | yes  |
| pptx              |           | no     | yes  |
| revealjs          | html      | yes    | yes  |
| rst               |           | yes    | yes  |
| rtf               |           | yes    | yes  |
| s5                | html      | yes    | yes  |
| slideous          | html      | yes    | yes  |
| slidy             | html      | yes    | yes  |
| texinfo           | texi      | yes    | yes  |
| textile           |           | yes    | yes  |

* Requirements

You need Emacs 24.4, org-mode 8.2, and Pandoc 2.0 (or later
versions). 

Installing Pandoc directly from
[[https://pandoc.org/installing.html][the official website]] is
recommended. The versions of Pandoc provided by package managers and
distributions is often quite out-of-date.

By default, =ox-pandoc= will check on starting up whether there is a
suitable pandoc executable available. When none is found, or the version
is too old,, a warning will be emitted. This warning can be suppressed
by setting customisation option =org-pandoc-check-version= to =nil=.

* Installation

You can install this tool with [[www.melpa.org][MELPA]].  For example,

#+BEGIN_SRC emacs-lisp
(setq package-archives
      '(("gnu" . "http://elpa.gnu.org/packages/")
        ("melpa" . "http://melpa.milkbox.net/packages/")))
#+END_SRC

: M-x package-install ⏎
: ox-pandoc ⏎

* Usage and Customisation
** Using Org's export-dispatch menu
   As always in Org, =C-c C-e= brings up the export dispatch menu for
   the current org-mode file. =ox-pandoc= lives under the =p= key. By
   default, options are offered to convert the org-file to a number of
   commonly used formats, such as LaTeX, PDF and HTML.

   As pandoc supports many formats, the default =org-export-dispatch=
   shortcut menu does not show all the supported formats. You can
   customize =org-pandoc-menu-entry= variable (and probably restart
   Emacs) to change its default menu entries. A full list of exporting
   commands and suggested shortcuts can be found in =ox-pandoc.el=.

** Running the Commands directly

For example, to convert org-mode file to 'html5' format, you may run
the following commands.

- =org-pandoc-export-as-html5= :: Exports to the HTML5 text as a buffer.
- =org-pandoc-export-to-html5= :: Exports to the HTML5 text file.
- =org-pandoc-export-to-html5-and-open= :: Exports and open HTML5 file.

Similar commands are prepared for a wide variety of other output
formats.

The opening of exported files in the =XXX-and-open= variants is handled
by =org-open-file=. Which applications are used for different file types
can be customised in Org Mode by the =org-file-apps= variable.

** User options and variables

You can specify the default options passed to pandoc and used on its
command-line for each document format. 

- =org-pandoc-options= :: General Pandoc options.
- =org-pandoc-options-for-FORMAT= :: Format-specific options.
- =org-pandoc-epub-rights= :: EPUB Copyright Statement.

Options should be specified by an alist. List of valid options are
defined in =org-pandoc-valid-options=. Only long-name options can be
used. For example, =metadata= must be given as the option name, even
though Pandoc accepts a short-form version of the argument ("-M").
Multiple values can be specified to options defined in
=org-pandoc-colon-separated-options=. They should be defined in
colon-separated list.

Values of options defined in =org-pandoc-file-options= will be
expanded to full path if they begin with =~= (tilde) character.

You can also specify output format extension with
=org-pandoc-format-extensions= variable.

For example:

#+BEGIN_SRC emacs-lisp
;; default options for all output formats
(setq org-pandoc-options '((standalone . t)))
;; cancel above settings only for 'docx' format
(setq org-pandoc-options-for-docx '((standalone . nil)))
;; special settings for beamer-pdf and latex-pdf exporters
(setq org-pandoc-options-for-beamer-pdf '((pdf-engine . "xelatex")))
(setq org-pandoc-options-for-latex-pdf '((pdf-engine . "pdflatex")))
;; special extensions for markdown_github output
(setq org-pandoc-format-extensions '(markdown_github+pipe_tables+raw_html))
#+END_SRC

** Hooks 
Hooks are also provided to be called when =pandoc= has completed processing.

- =org-pandoc-after-processing-FORMAT-hook= :: Hook called after processing =FORMAT=. 

These hooks are only available for text-file =FORMAT=.
=after-processing= options can not be specified to =epub=, =docx= or
=pdf= formats.

For preprocessing hooks, use =org-export-before-processing-hook=.

** Document-Specific Options

The following document-specific options can be specified. Value =nil=
overrides preceding option setting. Value =t= means only specify
option, but not its value. Options are delimited by space.
=#+PANDOC_OPTIONS:= can be specified multiple times. If you want to
specify the option value which include space character, the /entire/
option-value pair must be quoted (see example below).

- =PANDOC_OPTIONS:= :: Add command line options to the Pandoc process.
- =PANDOC_METADATA:= :: Metadata for Pandoc.
- =PANDOC_EXTENSIONS:= :: Extensions for specific Pandoc output.
- =PANDOC_VARIABLES:= :: Variables for Pandoc.
- =EPUB_RIGHTS:= :: copyright info to be embedded to EPUB metadata.
- =EPUB_CHAPTER_LEVEL:= :: same as 'epub-chapter-level' pandoc-option.
- =EPUB_STYLESHEET:= :: same as 'epub-stylesheet' pandoc-option.
- =EPUB_COVER:= :: same as 'epub-cover-image' pandoc-option.
- =EPUB_FONT:= :: same as 'epub-embed-font' pandoc-option. Only one
                  font can be specified in each line. Multiple fonts
                  can be specified by repeatedly use this option.
- =EPUB_META:= :: put contents into a temporary file and specify
                  that file to 'epub-metadata' option.
- =EPUB_CSS:= :: put contents into a temporary file and specify
                 that file to 'epub-stylesheet' option.
- =BIBLIOGRAPHY:= :: same as 'bibliography' pandoc-option. Only one
     bibliography can be specified in each line. Multiple
     bibliographies can be specified by repeatedly use this option.

Following is an example:

: # If you don't want author to be appeared, just leave it empty.
: #+AUTHOR:
: #+PANDOC_OPTIONS: standalone:t pdf-engine:pdflatex
: ## When option value includes whitespace, entire name:value pair must be quoted.
: #+PANDOC_OPTIONS: "epub-cover-image:/home/a/test file.png" standalone:nil
: #+PANDOC_OPTIONS: number-sections:nil
: #+PANDOC_OPTIONS: template:mytemplate.tex
: #+BIBLIOGRAPHY: sample.bib
: # Specifying Multiple values to single options by using colon-sparated lists.
: #+PANDOC_OPTIONS: filter:pandoc-zotxt:pandoc-citeproc
: #+PANDOC_OPTIONS: csl:IEEE.csl
: #+PANDOC_EXTENSIONS: markdown-typography latex+auto_identifiers
: #+PANDOC_VARIABLES: documentclass:IEEEtran
: #+PANDOC_VARIABLES: classoption:10pt,conference
: #+PANDOC_METADATA: page-progression-direction:ltr
: #+latex_header: \author{\IEEEauthorblockN{John Smith}
: #+latex_header: \IEEEauthorblockA{FooBar Institute\\
: #+latex_header: Email: john.smith@foo.bar}

** Delayed loading of ox-pandoc
If you want delayed loading of `ox-pandoc' when
=org-pandoc-menu-entry= is customized, please consider the following
settings in your init file.

#+BEGIN_SRC emacs-lisp
(with-eval-after-load 'ox
  (require 'ox-pandoc))
#+END_SRC

* Notes
** Temporary Files
=ox-pandoc= works by first using Org-mode's own conversion functions to
export a temporary version of the org file and then calling =pandoc=
with the appropriate switches on this file. This process creates
temporary files in the working directory called "XXXX.tmpZZZZ.org" and
"XXXX.tmpZZZZ.css" (if necessary). (ZZZZ is a random string)

Under normal operation the temporary files are deleted automatically
when `pandoc` has finished processing them. If you use =recentf=, you
may find these files clutter your recent files list. =M-x
recentf-cleanup= should remove them.
** Source Code Blocks
=ox-pandoc= supports the export of code blocks, including code blocks
for specific formats (e.g. LaTeX). Code wrapped in =BEGIN_EXPORT
[format]= will be passed to pandoc and included in the final output if
the output is of the appropriate format.

=ox-pandoc= also supports the evaluation of embedded code blocks wrapped
with =BEGIN_SRC [language]=. The various options described by the
[[https://orgmode.org/manual/Working-with-Source-Code.html#Working-with-Source-Code][Org-mode
manual]] for working with source code should be supported: source code,
results, both or neither can included in the final document and outputs
can be specified for particular output formats (e.g. HTML).

*IMPORTANT*: if you wish to include evaluated =SRC= blocks and their
results in documents to be processed by pandoc, each block should be
given a unique name. For example.

#+BEGIN_EXAMPLE
#+NAME: my--block
#+BEGIN_SRC emacs-lisp :exports both :results value
(+ 4 7)
#+END_SRC
#+END_EXAMPLE

** Obsolete In-File Options

Following options are supported in previous version of =ox-pandoc=.
They are no longer supported.

- =EPUB_METADATA:= :: obsolete. Use =epub-metadata= in
     =PANDOC_OPTIONS:= instead.
- =EPUB_STYLESHEET:= :: obsolete. Use =epub-stylesheet= in
     =PANDOC_OPTIONS:= instead.

** Citations
Pandoc offers a [[https://pandoc.org/org.html#citations][number of
options for processing citations]] in org documents. Until September
2021, Org-mode itself had no official citation syntax and a number of
incompatible solutions and formats. At present, if you wish to cite
references in an org-mode document to be rendered by Pandoc, there are a
number of approaches:

1. Ensure that your citation format (e.g. org-mode links from [[https://github.com/jkitchin/org-ref][org-ref]]) is translated to a citation format pandoc understands.
2. If exporting to LaTeX, ensure that the citations are translated to LaTeX citation commands.
3. Use a citation format that Pandoc understands in your source Org-mode file (this loses the advantages of syntax highlighting and interaction with the links).
4. Resolve all citations and bibliographies before passing to Pandoc.

If you wish Pandoc to process citations in an org-mode file, the file
should set =#+PANDOC_OPTIONS: citeproc:t= (or equivalent global setting)
and also specify the bibliography file with =#+BIBLIOGRAPHY:
my-references.bib=.

When the official Org-mode citation syntax becomes available in general
Org-mode releases (planned for Org 9.5, September 2021), =ox-pandoc=
will seek to support this.

* History and People
  This package was inspired by [[https://github.com/robtillotson/org-pandoc][org-pandoc]], but was entirely re-written by [[http://github.com/kawabata][kawabata]] who is the original author of =ox-pandoc=. The code was released as a emacs package via MELPA.

  In 2021, the package was updated to address small feature requests, apply patches and fix a number of bugs, most of which had arisen through changes in =pandoc= itself. The package is currently maintained by  [[http://github.com/a-fent][a-fent]].

* License

  GPLv2.

